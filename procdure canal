USE [dbEstudo]
GO
CREATE PROCEDURE [DataMart].[PrcDimCanal]
AS

DECLARE 
 @DtFim as DATE
,@DtInicio as DATE

SET @DtFim = DATEADD(DAY,1,EOMONTH(GETDATE())) -- 1° Dia do proximo mês
SET @DtInicio = DATEADD(MONTH,-1,@DtFim) -- 1° Dia do mês atual

DROP TABLE IF EXISTS #BASE 
SELECT DISTINCT
	A.[Canal_Origem]
INTO #BASE
FROM [dbEstudo].[Historico].[HistCallCenter] A
WHERE a.Data_Hora_Inicio >= @DtInicio and a.Data_Hora_Inicio < @DtFim

	MERGE [dbEstudo].[DataMart].[DimCanal] AS DESTINO
	USING #BASE AS ORIGEM
	ON(
		DESTINO.[Canal_Origem] = ORIGEM.[Canal_Origem]
		)
	WHEN NOT MATCHED THEN

	INSERT(
			[Canal_Origem]
			)
	VALUES(
			ORIGEM.[Canal_Origem]
			);

DROP TABLE IF EXISTS #BASE
